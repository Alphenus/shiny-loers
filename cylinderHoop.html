<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Making Lörs Lärä Again</title>
        <style>
        </style>

    </head>
    <body>

        <script src="libs/cannon.js"></script>
        <script>
        var Vec3 = CANNON.Vec3
        // create world
        var world = new CANNON.World();
        world.gravity.set(0,0,-9.82);
        world.broadphase = new CANNON.NaiveBroadphase();

        // create a cylinder
        var cylMass = 5, cylRad = 1;
        var qCyl = new CANNON.Quaternion();
        qCyl.setFromAxisAngle(new Vec3(1,0,0), Math.PI / 2)
        var cylShape = new CANNON.Cylinder(cylRad,cylRad,5,10);
        cylShape.transformAllPoints(new Vec3(),qCyl);
        var cylBody = new CANNON.Body({ mass:cylMass});
        cylBody.addShape(cylShape);
        cylBody.position.set(0,0,1);
        world.add(cylBody)

        // create a hoop
        var hoopMass = 0.01, hoopRad = 1.5;
        var qHoop = new CANNON.Quaternion();
        qHoop.setFromAxisAngle(new Vec3(1,0,0), Math.PI / 2);
        var hoopShape = new CANNON.Trimesh.createTorus(hoopRad,0.1,10,6);
        //hoopShape.transformAllPoints(new Vec3(),qHoop);
        var hoopBody = new CANNON.Body({ mass:hoopMass, shape:hoopShape, quaternion:qHoop});
        hoopBody.position.set(0,0,2.5);
        world.add(hoopBody);

        // add friction between cylinder and hoop
        var hoopMat = new CANNON.Material("hoopMat");
        var cylMat = new CANNON.Material("cylMat");
        var hoopCylContactMaterial = new CANNON.ContactMaterial(hoopMat, cylMat,{
            friction: 0.3,
            restitution: 0,
            contactEquationStiffness: 1000
          });
        world.addMaterial(hoopCylContactMaterial);

        // create base plane
        var groundShape = new CANNON.Plane();
        var groundBody = new CANNON.Body({ mass: 0, shape: groundShape});
        world.add(groundBody);

        var timeStep = 1.0 / 60.0; // seconds
        // make hoop spin
        var rimPosition = new Vec3(1.5,0,0)
        var impulse = new Vec3(0.1,0,0)
        hoopBody.applyImpulse(impulse,rimPosition)
        // let both fall
        for (var i = 0; i < 60; ++i){
          world.step(timeStep);
          console.log("cylinder position: " + cylBody.position.x,cylBody.position.y,cylBody.position.z);
          console.log("hoop position: " + hoopBody.position.x,hoopBody.position.y,hoopBody.position.z);
          console.log("hoop velocity: " + hoopBody.velocity);
          console.log("hoop angular velocity: " + hoopBody.angularVelocity);
        }
        /*
        // add impulse
        console.log("adding force")
        var imp = new CANNON.Vec3(1,0,0);
        sphereBody.applyForce(imp,sphereBody.position);
        for (var i = 0; i < 10; ++i){
          world.step(timeStep);
          console.log(sphereBody.position.x,sphereBody.position.y,sphereBody.position.z);
        }
        */
        </script>


    </body>
</html>
