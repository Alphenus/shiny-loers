<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Making Lörs Lärä Again</title>
        <style>
        </style>

    </head>
    <body>

        <script src="libs/cannon.js"></script>
        <script src="libs/three.min.js"></script>

        <script>
        var world, mass, cylMat, hoopMat, cylBody, hoopBody, shape, timeStep=1/60,
           camera, scene, renderer, geometry, material, cylMesh, hoopMesh, planeMesh;
        var Vec3 = CANNON.Vec3
        initThree();
        initCannon();
        animate();

        function initCannon() {

            // create world
            world = new CANNON.World();
            world.gravity.set(0,0,-9.81);
            world.broadphase = new CANNON.NaiveBroadphase();

            var cylMass = 10, cylRad = 0.2;

            var qCyl = new CANNON.Quaternion();
            qCyl.setFromAxisAngle(new Vec3(1,1,1), Math.PI / 2)
            var cylShape = new CANNON.Cylinder(cylRad,cylRad,5,10);

            cylShape.transformAllPoints(new Vec3(),qCyl);
            cylBody = new CANNON.Body({ mass:cylMass});
            cylBody.addShape(cylShape);
            cylBody.position.set(0,0,1);
            world.add(cylBody)

            //Create Plane for physics
            var groundShape = new CANNON.Plane();
            groundBody = new CANNON.Body({ mass: 0, shape: groundShape});
            groundBody.position.set(0,0,0);

            world.add(groundBody);

        }

        function initThree() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 100 );

            var campos = 10;
            camera.position.x = campos;
            camera.position.y = campos;
            camera.position.z = campos;

            camera.rotation.x = -45 * Math.PI / 180;
            camera.rotation.y = 45 * Math.PI / 180;
            camera.rotation.z = (150) * Math.PI / 180;
            scene.add( camera );

            var axisHelper = new THREE.AxisHelper(3);
            scene.add(axisHelper);

            var cylGeometry = new THREE.CylinderGeometry( 0.5, 0.5, 1, 32 );
            var torGeometry = new THREE.TorusGeometry( 0.5, 1/10, 16, 128 );
            var planeGeometry = new THREE.PlaneGeometry( 10, 10, 32 );

            material = new THREE.MeshBasicMaterial( { color: 0xcc5555, wireframe: true } );

            cylMesh = new THREE.Mesh( cylGeometry, material );
            hoopMesh = new THREE.Mesh( torGeometry, material );
            planeMesh = new THREE.Mesh(planeGeometry, material);

            scene.add( cylMesh );
            scene.add( planeMesh );
            /*scene.add( hoopMesh );*/

            renderer = new THREE.WebGLRenderer();

            renderer.setSize( window.innerWidth, window.innerHeight );
            document.body.appendChild( renderer.domElement );

        }


          function animate() {
              requestAnimationFrame( animate );
              updatePhysics();
              render();
          }

          function updatePhysics() {
              // Step the physics world
              world.step(timeStep);
              // Copy coordinates from Cannon.js to Three.js

              cylMesh.position.copy(cylBody.position);
            /*
              hoopMesh.position.copy(hoopBody.position);
              hoopMesh.quaternion.copy(hoopBody.quaternion);
              console.log("hoop angular velocity: " + hoopBody.angularVelocity);
              */
          }
          function render() {
              renderer.render( scene, camera );
          }

        </script>


    </body>
</html>
